*  Midterm q3c
.include tsmc18.sp
.global vdd 


* Power supply
VDD vdd 0 1.8

*Signals
Vx1 x1 0 PULSE(0 1.8 0n 0.1n 0.1n 5n 10n)
Vx2 x2 0 PULSE(0 1.8 0n 0.1n 0.1n 10n 20n)
Vx3 x3 0 PULSE(0 1.8 0n 0.1n 0.1n 20n 40n)

* NOR and Inverter

xnor x1 x2 x3 outnor nor 
xinvnor outnor outynorinv inv

* 3 Inv and NAND

xinvnand1 x1 x1n inv
xinvnand2 x2 x2n inv
xinvnand3 x3 x3n inv

xnand x1 x2 x3 outyinvnand nand

.control

tran 10p 80n

* Delay from x1 to out nor 
meas tran tphlx1tooutnor TRIG v(x1) VAL=0.9 RISE=1 TARG v(outynorinv) VAL=0.9 FALL=1
meas tran tplhx1tooutnor TRIG v(x1) VAL=0.9 FALL=1 TARG v(outynorinv) VAL=0.9 RISE=1

* Delay from x2 to out nor 
meas tran tphlx2tooutnor TRIG v(x2) VAL=0.9 RISE=1 TARG v(outynorinv) VAL=0.9 FALL=1
meas tran tplhx2tooutnor TRIG v(x2) VAL=0.9 FALL=1 TARG v(outynorinv) VAL=0.9 RISE=1


* Delay from x3 to out nor 
meas tran tphlx3tooutnor TRIG v(x3) VAL=0.9 RISE=1 TARG v(outynorinv) VAL=0.9 FALL=1
meas tran tplhx3tooutnor TRIG v(x3) VAL=0.9 FALL=1 TARG v(outynorinv) VAL=0.9 RISE=1

* Delay from x1 to out nand 
meas tran tphlx1tooutnand TRIG v(x1) VAL=0.9 RISE=1 TARG v(outyinvnand) VAL=0.9 FALL=1
meas tran tplhx1tooutnand TRIG v(x1) VAL=0.9 FALL=1 TARG v(outyinvnand) VAL=0.9 RISE=1

* Delay from x2 to out nand 
meas tran tphlx2tooutnand TRIG v(x2) VAL=0.9 RISE=1 TARG v(outyinvnand) VAL=0.9 FALL=1
meas tran tplhx2tooutnand TRIG v(x2) VAL=0.9 FALL=1 TARG v(outyinvnand) VAL=0.9 RISE=1

* Delay from x3 to out nand 
meas tran tphlx3tooutnand TRIG v(x3) VAL=0.9 RISE=1 TARG v(outyinvnand) VAL=0.9 FALL=1
meas tran tplhx3tooutnand TRIG v(x3) VAL=0.9 FALL=1 TARG v(outyinvnand) VAL=0.9 RISE=1

plot v(x1) v(x2)+2 v(x3)+4 v(outyinvnand)+6 v(outynorinv)+8

.endc


.subckt inv in out wp=0.3u wn=0.3u
m1 out in vdd vdd cmosp w='wp' l=0.2u ad='wp*0.55u' as='wp*0.55u' pd='2*(wp+0.55u)' ps='2*(wp+0.55u)'
m2 out in 0 0 cmosn w='wn' l=0.2u ad='wn*0.55u' as='wn*0.55u' pd='2*(wn+0.55u)' ps='2*(wn+0.55u)'
.ends


.subckt nand x1 x2 x3 out wp=0.3u wn=0.3u

mp1 out x1 vdd vdd cmosp w='wp' l=0.2u ad='wp*0.55u' as='wp*0.55u' pd='2*(wp+0.55u)' ps='2*(wp+0.55u)'
mp2 out x2 vdd vdd cmosp w='wp' l=0.2u ad='wp*0.55u' as='wp*0.55u' pd='2*(wp+0.55u)' ps='2*(wp+0.55u)'
mp3 out x3 vdd vdd cmosp w='wp' l=0.2u ad='wp*0.55u' as='wp*0.55u' pd='2*(wp+0.55u)' ps='2*(wp+0.55u)'

mn1 out x1 n1 n1 cmosn w='wn' l=0.2u ad='wn*0.55u' as='wn*0.55u' pd='2*(wn+0.55u)' ps='2*(wn+0.55u)'
mn2 n1 x2 n2 n2 cmosn w='wn' l=0.2u ad='wn*0.55u' as='wn*0.55u' pd='2*(wn+0.55u)' ps='2*(wn+0.55u)'
mn3 n2 x2 0 0 cmosn w='wn' l=0.2u ad='wn*0.55u' as='wn*0.55u' pd='2*(wn+0.55u)' ps='2*(wn+0.55u)'

.ends

.subckt nor x1 x2 x3 out wp=0.3u wn=0.3u

mp1 p1 x1 vdd vdd cmosp w='wp' l=0.2u ad='wp*0.55u' as='wp*0.55u' pd='2*(wp+0.55u)' ps='2*(wp+0.55u)'
mp2 p2 x2 p1 p1 cmosp w='wp' l=0.2u ad='wp*0.55u' as='wp*0.55u' pd='2*(wp+0.55u)' ps='2*(wp+0.55u)'
mp3 out x3 p2 p2 cmosp w='wp' l=0.2u ad='wp*0.55u' as='wp*0.55u' pd='2*(wp+0.55u)' ps='2*(wp+0.55u)'

mn1 out x1 0 0 cmosn w='wn' l=0.2u ad='wn*0.55u' as='wn*0.55u' pd='2*(wn+0.55u)' ps='2*(wn+0.55u)'
mn2 out x2 0 0 cmosn w='wn' l=0.2u ad='wn*0.55u' as='wn*0.55u' pd='2*(wn+0.55u)' ps='2*(wn+0.55u)'
mn3 out x3 0 0 cmosn w='wn' l=0.2u ad='wn*0.55u' as='wn*0.55u' pd='2*(wn+0.55u)' ps='2*(wn+0.55u)'

.ends

.end